<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Galerie Chauffeurs ‚Äî DIGIY DRIVER</title>
  <meta name="theme-color" content="#22c55e" />
  <meta name="description" content="Galerie publique des chauffeurs DIGIY DRIVER ‚Äî zones, disponibilit√©, contact direct WhatsApp. 0% commission." />
  <style>
    :root{
      --green:#22c55e;
      --green2:#16a34a;
      --sky:#0ea5e9;
      --bg:#f0fdf4;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --shadow:0 12px 28px rgba(2,6,23,.08);
      --radius:18px;
      --warn:#f59e0b;
      --warnBg:rgba(245,158,11,.12);
      --warnBd:rgba(245,158,11,.35);
      --warnTx:#7c2d12;
      --bd:rgba(15,23,42,.10);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #dcfce7 0%, var(--bg) 55%, #fff 100%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      padding:16px 14px;
      background: linear-gradient(90deg, var(--green), #4ade80);
      color:#fff;
      box-shadow: 0 10px 22px rgba(34,197,94,.32);
    }
    .wrap{max-width:980px; margin:0 auto; padding:14px;}
    .topRow{
      max-width:980px; margin:0 auto;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; flex-wrap:wrap;
    }
    .brand{
      font-weight:1000;
      letter-spacing:.3px;
      display:flex; align-items:center; gap:10px;
      font-size:17px;
      white-space:nowrap;
    }
    .pill{
      background: rgba(255,255,255,.22);
      border:1px solid rgba(255,255,255,.35);
      padding:7px 11px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .card{
      background:#ffffffcc;
      backdrop-filter: blur(7px);
      border:1px solid rgba(15,23,42,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      margin-bottom:12px;
    }
    .bar{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
    }
    @media(max-width:860px){
      .bar{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
    }
    .field label{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      display:block;
      margin-bottom:6px;
    }
    select, input{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.12);
      outline:none;
      font-size:14px;
      background:#fff;
    }
    .status{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .status .left{display:flex; flex-direction:column; gap:2px}
    .status .title{font-weight:1000}
    .status .sub{font-size:12px; color:var(--muted); font-weight:800; line-height:1.35}
    .badge{
      font-size:12px;
      font-weight:1000;
      padding:8px 10px;
      border-radius:999px;
      background:#dcfce7;
      border:1px solid rgba(34,197,94,.22);
      color:#14532d;
      white-space:nowrap;
    }
    .badge.warn{
      background:var(--warnBg);
      border:1px solid var(--warnBd);
      color:var(--warnTx);
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;
    }
    .driver{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border:1px solid rgba(15,23,42,.08);
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    .head{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .name{
      font-weight:1000;
      font-size:15px;
      line-height:1.2;
    }
    .meta{
      margin-top:8px;
      display:flex; flex-wrap:wrap; gap:8px;
      font-size:12px;
      color:var(--muted);
      font-weight:900;
    }
    .tag{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--bd);
      background:#fff;
    }
    .actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;}
    button, a.btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:11px 12px;
      border:none;
      border-radius:14px;
      font-weight:1000;
      font-size:14px;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
    }
    button:disabled{opacity:.55; cursor:not-allowed}
    .btn-main{background:var(--green2); color:#fff}
    .btn-sky{background:var(--sky); color:#fff}
    .btn-ghost{
      background:#fff;
      border:1px solid rgba(15,23,42,.12);
      color:var(--text);
    }
    .footCta{
      text-align:center;
    }
    .footCta .big{
      font-weight:1100;
      font-size:16px;
    }
    .footCta .small{
      margin-top:6px;
      color:var(--muted);
      font-weight:900;
      font-size:13px;
      line-height:1.35;
    }
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 16px;
      background: rgba(15,23,42,.92);
      color:#fff;
      padding:10px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 900;
      display:none;
      z-index: 20;
      max-width: 92vw;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Lang switch (header) */
    .lang-switch{
      display:flex;
      gap:6px;
      padding:4px;
      border-radius:999px;
      background: rgba(255,255,255,.22);
      border:1px solid rgba(255,255,255,.35);
    }
    .lang-switch button{
      border:none;
      padding:7px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:1000;
      font-size:12px;
      background:transparent;
      color:#fff;
    }
    .lang-switch button.active{
      background:#0f172a;
      color:#fff;
    }
  </style>
</head>

<body>
<header>
  <div class="topRow">
    <div class="brand">
      üöï DIGIY DRIVER
      <span class="pill" data-i18n="gallery_title">Galerie Chauffeurs</span>
    </div>

    <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
      <div class="lang-switch" aria-label="Language switch">
        <button id="lang-fr" class="active" type="button">FR</button>
        <button id="lang-wo" type="button">WO</button>
      </div>
      <div class="pill" id="countPill">‚Ä¶</div>
    </div>
  </div>
</header>

<main class="wrap">

  <div class="card status">
    <div class="left">
      <div class="title" data-i18n="hero_title">üîé Trouve un chauffeur pr√®s de toi</div>
      <div class="sub" data-i18n="hero_sub">Filtre par zone / recherche. Contact direct WhatsApp. Paiement direct (0% commission).</div>
    </div>
    <div class="badge" id="liveBadge" data-i18n="badge_public">Public</div>
  </div>

  <div class="card">
    <div class="bar">
      <div class="field">
        <label data-i18n="label_zone">üìç Zone</label>
        <select id="zoneFilter">
          <option value="" data-i18n="zone_all">Toutes</option>
          <option value="Plateau">Plateau</option>
          <option value="Almadies">Almadies</option>
          <option value="Yoff">Yoff</option>
          <option value="Saly">Saly</option>
        </select>
      </div>

      <div class="field">
        <label data-i18n="label_search">üîé Recherche</label>
        <input id="qFilter" placeholder="Nom, ville, v√©hicule‚Ä¶" />
      </div>

      <div class="field">
        <label data-i18n="label_avail">üü¢ Dispo</label>
        <select id="availFilter">
          <option value="all" selected data-i18n="avail_all">Tous</option>
          <option value="online" data-i18n="avail_online">En ligne</option>
          <option value="offline" data-i18n="avail_offline">Hors-ligne</option>
        </select>
      </div>
    </div>
  </div>

  <div class="grid" id="drivers"></div>

  <div class="card footCta">
    <div class="big" data-i18n="cta_driver_title">Vous √™tes chauffeur ?</div>
    <div class="small" data-i18n="cta_driver_sub">Cr√©e ta fiche et re√ßois des clients en direct.</div>
    <div class="actions" style="justify-content:center; margin-top:12px;">
      <a class="btn btn-main" href="https://driver.digiylyfe.com/" rel="noopener" data-i18n="cta_become_driver">Devenir chauffeur</a>
      <a class="btn btn-ghost" href="https://wa.me/221771342889" rel="noopener" data-i18n="cta_whatsapp">WhatsApp</a>
      <a class="btn btn-sky" href="https://driver.digiylyfe.com/" rel="noopener" data-i18n="cta_order_ride">Commander une course</a>
    </div>
  </div>

</main>

<div class="toast" id="toast"></div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  /* =========================
     i18n ‚Äî FR / WO (Wolof)
     ========================= */
  const DIGIY_LANG = {
    fr: {
      gallery_title: "Galerie Chauffeurs",
      hero_title: "üîé Trouve un chauffeur pr√®s de toi",
      hero_sub: "Filtre par zone / recherche. Contact direct WhatsApp. Paiement direct (0% commission).",
      badge_public: "Public",
      badge_loading: "Chargement‚Ä¶",
      badge_fallback: "‚ö†Ô∏è Public (fallback)",

      label_zone: "üìç Zone",
      zone_all: "Toutes",

      label_search: "üîé Recherche",
      search_ph: "Nom, ville, v√©hicule‚Ä¶",

      label_avail: "üü¢ Dispo",
      avail_all: "Tous",
      avail_online: "En ligne",
      avail_offline: "Hors-ligne",

      count_drivers: (n) => `${n} chauffeur(s)`,

      empty_title: "Aucun chauffeur trouv√©",
      empty_tag_1: "Change les filtres",
      empty_tag_2: "Ou contacte WhatsApp",
      btn_support_whatsapp: "WhatsApp support",
      btn_order_ride: "Commander une course",

      driver_default_name: "Chauffeur",
      tag_online: "üü¢ En ligne",
      tag_offline: "‚ö™ Hors-ligne",
      pill_public: "Public",
      btn_whatsapp: "WhatsApp",

      cta_driver_title: "Vous √™tes chauffeur ?",
      cta_driver_sub: "Cr√©e ta fiche et re√ßois des clients en direct.",
      cta_become_driver: "Devenir chauffeur",
      cta_whatsapp: "WhatsApp",
      cta_order_ride: "Commander une course",

      fallback_title: "‚ö†Ô∏è Galerie pas encore branch√©e",
      fallback_tag_1: "La source Supabase \"public_driver_cards\" n‚Äôest pas accessible",
      fallback_tag_2: "RLS / vue publique √† cr√©er",

      toast_fallback: "Galerie en mode fallback (public)"
    },

    wo: {
      gallery_title: "Galerie Chauffeur yi",
      hero_title: "üîé Seetal chauffeur bi ci sa wet",
      hero_sub: "T√†nn zone / seet. WhatsApp ci diggante. Fey bu jublu (0% commission).",
      badge_public: "Public",
      badge_loading: "Di y√ºk‚Ä¶",
      badge_fallback: "‚ö†Ô∏è Public (fallback)",

      label_zone: "üìç Zone",
      zone_all: "Y√©pp",

      label_search: "üîé Seet",
      search_ph: "Tur, d√´kk, voiture‚Ä¶",

      label_avail: "üü¢ Dispo",
      avail_all: "Y√©pp",
      avail_online: "Ci ligne",
      avail_offline: "Hors-ligne",

      count_drivers: (n) => `${n} chauffeur`,

      empty_title: "Amul chauffeur bu √±u gis",
      empty_tag_1: "Soppi filtre yi",
      empty_tag_2: "Walla bataaxal WhatsApp",
      btn_support_whatsapp: "WhatsApp support",
      btn_order_ride: "Jox ma course",

      driver_default_name: "Chauffeur",
      tag_online: "üü¢ Ci ligne",
      tag_offline: "‚ö™ Hors-ligne",
      pill_public: "Public",
      btn_whatsapp: "WhatsApp",

      cta_driver_title: "Yow, yaa di chauffeur ?",
      cta_driver_sub: "Def sa fiche te jot client yi ci direct.",
      cta_become_driver: "Nekkal chauffeur",
      cta_whatsapp: "WhatsApp",
      cta_order_ride: "Jox ma course",

      fallback_title: "‚ö†Ô∏è Galerie bi du connect√©",
      fallback_tag_1: "Source Supabase \"public_driver_cards\" du√±u ko j√†pp",
      fallback_tag_2: "RLS / vue publique war na√±u ko def",

      toast_fallback: "Galerie bi ci mode fallback (public)"
    }
  };

  let CURRENT_LANG = localStorage.getItem("digiy_lang") || "fr";

  function t(key, ...args){
    const pack = DIGIY_LANG[CURRENT_LANG] || DIGIY_LANG.fr;
    const val = pack[key];
    if (typeof val === "function") return val(...args);
    return (val != null) ? String(val) : String((DIGIY_LANG.fr[key] ?? key));
  }

  function applyLanguage(lang){
    CURRENT_LANG = (lang === "wo") ? "wo" : "fr";
    localStorage.setItem("digiy_lang", CURRENT_LANG);

    // html lang
    document.documentElement.setAttribute("lang", CURRENT_LANG === "wo" ? "wo" : "fr");

    // static texts
    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const key = el.dataset.i18n;
      const val = t(key);
      if (val) el.textContent = val;
    });

    // placeholder
    const q = document.getElementById("qFilter");
    if (q) q.setAttribute("placeholder", t("search_ph"));

    // buttons state
    document.getElementById("lang-fr")?.classList.toggle("active", CURRENT_LANG==="fr");
    document.getElementById("lang-wo")?.classList.toggle("active", CURRENT_LANG==="wo");
  }

  document.getElementById("lang-fr").addEventListener("click", ()=>{ applyLanguage("fr"); render(); });
  document.getElementById("lang-wo").addEventListener("click", ()=>{ applyLanguage("wo"); render(); });

  /* === SUPABASE (public) === */
  const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

  const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  /* === CONFIG ===
     üëâ Cr√©e c√¥t√© Supabase une VIEW/TABLE publique: public_driver_cards
     Colonnes recommand√©es:
       id (uuid/text)
       name (text)
       city (text)
       zone (text)
       car (text)
       whatsapp (text)  // ex: 22177xxxxxxx
       is_online (bool) // optionnel
       rating (numeric) // optionnel
  */
  const PUBLIC_SOURCE = "public_driver_cards";

  /* UI */
  const driversEl = document.getElementById("drivers");
  const zoneFilter = document.getElementById("zoneFilter");
  const qFilter = document.getElementById("qFilter");
  const availFilter = document.getElementById("availFilter");
  const countPill = document.getElementById("countPill");
  const liveBadge = document.getElementById("liveBadge");
  const toastEl = document.getElementById("toast");

  let ALL = [];

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.style.display = "block";
    clearTimeout(globalThis.__t);
    globalThis.__t = setTimeout(()=> toastEl.style.display="none", 2400);
  }

  function esc(s){
    return String(s ?? "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  function normPhone(p){
    const digits = String(p ?? "").replace(/\D/g,"");
    if (!digits) return "";
    return digits;
  }

  function passes(d){
    const z = (zoneFilter.value || "").trim();
    const q = (qFilter.value || "").trim().toLowerCase();
    const a = availFilter.value || "all";

    if (z && String(d.zone || "") !== z) return false;

    if (a === "online" && d.is_online !== true) return false;
    if (a === "offline" && d.is_online === true) return false;

    if (q){
      const hay = `${d.name||""} ${d.city||""} ${d.zone||""} ${d.car||""}`.toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  }

  function render(){
    const items = ALL.filter(passes);
    countPill.textContent = t("count_drivers", items.length);

    if (!items.length){
      driversEl.innerHTML = `
        <div class="driver" style="grid-column:1/-1">
          <div class="name">${esc(t("empty_title"))}</div>
          <div class="meta">
            <span class="tag">${esc(t("empty_tag_1"))}</span>
            <span class="tag">${esc(t("empty_tag_2"))}</span>
          </div>
          <div class="actions">
            <a class="btn btn-main" href="https://wa.me/221771342889" rel="noopener">${esc(t("btn_support_whatsapp"))}</a>
            <a class="btn btn-ghost" href="https://driver.digiylyfe.com/" rel="noopener">${esc(t("btn_order_ride"))}</a>
          </div>
        </div>
      `;
      return;
    }

    driversEl.innerHTML = items.map(d => {
      const name = esc(d.name || t("driver_default_name"));
      const city = esc(d.city || "");
      const zone = esc(d.zone || "");
      const car  = esc(d.car || "");
      const online = (d.is_online === true);
      const rating = (d.rating != null && d.rating !== "") ? Number(d.rating) : null;
      const wa = normPhone(d.whatsapp);

      const badge = online
        ? `<span class="tag" style="border-color:rgba(34,197,94,.25)">${esc(t("tag_online"))}</span>`
        : `<span class="tag">${esc(t("tag_offline"))}</span>`;

      const rateTag = (rating && !Number.isNaN(rating)) ? `<span class="tag">‚≠ê ${rating.toFixed(1)}</span>` : ``;

      return `
        <div class="driver">
          <div class="head">
            <div>
              <div class="name">üöï ${name}</div>
              <div class="meta">
                ${city ? `<span class="tag">üèôÔ∏è ${city}</span>` : ``}
                ${zone ? `<span class="tag">üìç ${zone}</span>` : ``}
                ${car  ? `<span class="tag">üöó ${car}</span>` : ``}
                ${badge}
                ${rateTag}
              </div>
            </div>
            <div class="pill" style="color:#0f172a;background:#fff;border-color:rgba(15,23,42,.15)">
              ${esc(t("pill_public"))}
            </div>
          </div>

          <div class="actions">
            ${wa ? `<a class="btn btn-main" href="https://wa.me/${wa}" rel="noopener">${esc(t("btn_whatsapp"))}</a>`
                 : `<button class="btn btn-main" disabled>${esc(t("btn_whatsapp"))}</button>`}
            <a class="btn btn-ghost" href="https://driver.digiylyfe.com/" rel="noopener">${esc(t("btn_order_ride"))}</a>
          </div>
        </div>
      `;
    }).join("");
  }

  async function load(){
    liveBadge.textContent = t("badge_loading");
    try{
      const { data, error } = await sb
        .from(PUBLIC_SOURCE)
        .select("*")
        .limit(250);

      if (error) throw error;

      ALL = Array.isArray(data) ? data : [];
      liveBadge.textContent = t("badge_public");
      render();
    }catch(e){
      console.warn("Public gallery error:", e);
      liveBadge.textContent = t("badge_fallback");

      ALL = [];
      countPill.textContent = "‚Ä¶";

      driversEl.innerHTML = `
        <div class="driver" style="grid-column:1/-1">
          <div class="name">${esc(t("fallback_title"))}</div>
          <div class="meta">
            <span class="tag">${esc(t("fallback_tag_1"))}</span>
            <span class="tag">${esc(t("fallback_tag_2"))}</span>
          </div>
          <div class="actions">
            <a class="btn btn-main" href="https://wa.me/221771342889" rel="noopener">${esc(t("cta_whatsapp"))}</a>
            <a class="btn btn-ghost" href="https://driver.digiylyfe.com/" rel="noopener">${esc(t("btn_order_ride"))}</a>
          </div>
        </div>
      `;

      toast(t("toast_fallback"));
    }
  }

  zoneFilter.addEventListener("change", render);
  availFilter.addEventListener("change", render);
  qFilter.addEventListener("input", () => {
    clearTimeout(globalThis.__q);
    globalThis.__q = setTimeout(render, 120);
  });

  // init language then load
  applyLanguage(CURRENT_LANG);
  load();
</script>
</body>
</html>
